<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Temp Mail â€“ Full Inbox</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:20px; }
    h1 { text-align:center; }
    .box { max-width:800px; margin:auto; background:#020617; padding:20px; border-radius:12px; }
    button { padding:10px 14px; border-radius:8px; border:none; background:#7c3aed; color:#fff; cursor:pointer; }
    button:hover { background:#6d28d9; }
    .email { margin:10px 0; padding:10px; border:1px solid #334155; border-radius:8px; word-break:break-all; }
    .layout { display:grid; grid-template-columns: 1fr 2fr; gap:12px; }
    .inbox, .reader { border:1px solid #334155; border-radius:10px; padding:10px; min-height:300px; }
    .msg { padding:8px; border-radius:6px; border:1px solid #334155; margin-bottom:6px; cursor:pointer; }
    .msg:hover { background:#1e293b; }
    iframe { width:100%; height:100%; border:none; background:#fff; }
    .empty { opacity:.7; font-size:14px; }
  </style>
</head>
<body>
<div class="box">
  <h1>DarK Mail</h1>
  <button onclick="createMail()">Generate Email</button>
  <div id="email" class="email">No email generated</div>

  <div class="layout">
    <div class="inbox">
      <b>Inbox</b>
      <div id="messages" class="empty">No messages</div>
      <button style="margin-top:8px" onclick="loadInbox()">Refresh Inbox</button>
    </div>
    <div class="reader">
      <b>Mail Reader</b>
      <div id="reader" class="empty">Select a message to read</div>
    </div>
  </div>
</div>

<script>
let token = null;
let emailAddr = null;

async function createMail() {
  document.getElementById('messages').innerHTML = 'Loading...';
  document.getElementById('reader').innerHTML = 'Select a message to read';

  const dRes = await fetch('https://api.mail.tm/domains');
  const dJson = await dRes.json();
  const domain = dJson['hydra:member'][0].domain;

  const user = 'user' + Math.random().toString(36).slice(2, 9);
  const pass = 'Pass@12345';
  emailAddr = `${user}@${domain}`;

  await fetch('https://api.mail.tm/accounts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ address: emailAddr, password: pass })
  });

  const login = await fetch('https://api.mail.tm/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ address: emailAddr, password: pass })
  }).then(r => r.json());

  token = login.token;
  document.getElementById('email').innerText = emailAddr;
  loadInbox();
}

async function loadInbox() {
  if (!token) return;
  const box = document.getElementById('messages');
  box.innerHTML = 'Loading inbox...';

  const res = await fetch('https://api.mail.tm/messages', {
    headers: { Authorization: `Bearer ${token}` }
  }).then(r => r.json());

  const list = Array.isArray(res['hydra:member']) ? res['hydra:member'] : [];
  box.innerHTML = '';

  if (!list.length) {
    box.innerHTML = '<div class="empty">No messages yet</div>';
    return;
  }

  list.forEach(m => {
    const d = document.createElement('div');
    d.className = 'msg';
    d.innerHTML = `<b>${m.subject || '(No subject)'}</b><br>${m.from?.address || ''}`;
    d.onclick = () => readMessage(m.id);
    box.appendChild(d);
  });
}

async function readMessage(id) {
  const reader = document.getElementById('reader');
  reader.innerHTML = 'Loading message...';

  const m = await fetch(`https://api.mail.tm/messages/${id}`, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(r => r.json());

  if (m.html && m.html.length) {
    reader.innerHTML = '';
    const frame = document.createElement('iframe');
    frame.srcdoc = m.html[0];
    reader.appendChild(frame);
  } else {
    reader.innerHTML = `<pre>${m.text || 'No content'}</pre>`;
  }
}
</script>
</body>
</html>
